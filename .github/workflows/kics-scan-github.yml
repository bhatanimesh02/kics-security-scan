name: scan with KICS and upload SARIF

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  kics-job:
    runs-on: ubuntu-latest
    name: kics-action
    steps:
      - name: Checkout repo
        uses: actions/checkout@v2
      - name: Run KICS Scan
        uses: checkmarx/kics-action@v1.2
        with:
          path: './'
          output_path: results-dir
          platform_type: terraform
          output_formats: 'json,sarif'
      - name: Show results
        run: |
          cat results.json
